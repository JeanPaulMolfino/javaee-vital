<!DOCTYPE HTML>
<html>
   <head>
   <style>
	.button {
 	 background-color: #4CAF50; 
  	border: none;
  	color: white;
  	padding: 20px;
  	text-align: center;
  	text-decoration: none;
  	display: inline-block;
  	font-size: 16px;
  	margin: 4px 2px;
  	cursor: pointer;
	}
   </style>

	<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
	<meta content="utf-8" http-equiv="encoding">
       <script src="jquery.js"></script>
	<script src="moment.js"></script>
      <script type="text/javascript">
       	var ws;
	var alerta = false;
	var presionmax = 10;
	var presionmin = 4;
	var volumendegas= 20;
	var frecuenciaaporte= 15;
	var composicionmezcla= 3;
	var humedadaire= 36;
	var temperaturaentrada= 12;
	var temperaturasalida= 12;
	var presionentrada= 20;
	var presionsalida= 20;

          function IniciarConexion(){
                ws= new WebSocket("ws://localhost:8080/WebService/vemec");
                ws.onopen= function(){
                    console.log("Conexión Abierta, Puedes enviar Mensajes");
                }
                ws.onclose= function(){
                console.log("Conexión Cerrada");
                }
          }

		function alertar(){
		       if(alerta == true){
				alerta = false;
			}else{ alerta = true;}
          	}

	function getRandomArbitrary(min, max) {
  		return Math.floor(Math.random() * (max - min + 1)) + min;
	}

	function sleep(milliseconds) {
	 var start = new Date().getTime();
	 for (var i = 0; i < 1e7; i++) {
	  if ((new Date().getTime() - start) > milliseconds) {
	   break;
	  }
	 }
	}
		var counter = 0;
		var matriz = new Array();
		var idvemec = 1;
		function crearJson(){
			counter++;
			var arreglo = new Object();
			//arreglo.id = 1;

			if(alerta == true){
				arreglo.presionmax = 1;
				arreglo.presionmin = 1;
			} else {
				arreglo.presionmax = presionmax + getRandomArbitrary(-2, 2);
				arreglo.presionmin = presionmin + getRandomArbitrary(-2, 2);
			}
			
			
			arreglo.volumendegas = volumendegas + getRandomArbitrary(-2, 2);
			arreglo.frecuenciaaporte = frecuenciaaporte + getRandomArbitrary(-2, 2);
			arreglo.composicionmezcla = composicionmezcla + getRandomArbitrary(-2, 2);
			arreglo.humedadaire = humedadaire + getRandomArbitrary(-2, 2);
			arreglo.temperaturaentrada = temperaturaentrada + getRandomArbitrary(-2, 2);
			arreglo.temperaturasalida = temperaturasalida + getRandomArbitrary(-2, 2);
			arreglo.presionentrada = presionentrada + getRandomArbitrary(-2, 2);
			arreglo.presionsalida = presionsalida + getRandomArbitrary(-2, 2);
			arreglo.fecha = moment().format('YYYY-MM-DD HH:mm:ss');

			matriz.push(arreglo);
			if(counter == 29 || alerta == true){

				//var alertaf = new Object();
				//alertaf.alerta = alerta;
				//matriz.push(alertaf);
				
				var result = new Object();
				result.idvemec = idvemec;
				result.alerta = alerta;
				result.datos = matriz;
				var json = JSON.stringify(result);
				ws.send(json);
				if(alerta == true){				
					console.log("MODO DE ALERTA");
				}
				console.log(json);
				matriz = new Array();
				counter = 0;
			}
          	}
		window.onload = IniciarConexion();
		window.onload = setInterval('crearJson()',2000);
	
       </script>
   </head>
   <body>
      <div>	  
          <input type="button" class="button" onclick="alertar()" id="btnAlert" value="MODIFICAR ALERTA">	
      </div>
      
   </body>
</html>
